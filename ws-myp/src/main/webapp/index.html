<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width; initial-scale = 1.0; maximum-scale=1.0; user-scalable=no" />
<link rel="stylesheet" href="_/css/myp.css" />
<script src="_/js/jquery-1.7.1.min.js" type="text/javascript"></script>
<script src="_/js/underscore-min.js" type="text/javascript"></script>
<script src="_/js/util.js" type="text/javascript"></script>
<script src="_/js/test.js" type="text/javascript"></script>
<title>Make Your Picks Mobile</title>
</head>

<script type="text/template" id="container"> 
<% 
var pickmap = {};
var points = 0;

_.each(picks,function(pick,i) {
	pickmap[pick.game.id] = pick; 
});
			
//console.log(games);

_.each(games,function(game, i) { 
	//console.log('game='+game);
	//gamemap[game.id] = data.game.id;	
								
%>
			
	<div class="gamebox">
		<div class="gametime"><%=game.gameStartDisplay%></div>
			 
				 
<% 
			 //DETERMINE IF WIN OR NOT
	var pick;
	if (pickmap[game.id]) {
		pick = pickmap[game.id];

		//increament the pouints
		points += pick.winValue;
	}
	

	//check to see user has made pick
	if (pick) {

%>
		<div class="scoreboard shadow 
<%
		if(pick.winnerStatus == 1) {
%>
			win
<%
			if(pick.weight == 2) {
%>
				double	
<%				  
			}	

		}
		else if (pick.winnerStatus == 2) {
%>
			loss
<%
			if(pick.weight == 2) {
%>
				double
<%
			}
		}
		//div closes scoreboard
%>
		">
<%
		if(pick.fav) {
%>
		<div class="pickbox">
			<div class="pick <%=i%> <%=pick.game.fav.shortName%>"></div>
		</div>
<% 
		} else {
%>
		<div class="pickbox">
			<div class="pick <%=i%> <%=pick.game.dog.shortName%>"></div>
		</div>
<% 
		}

		var winner = "";
		
		//need to figure out which row to mark as a loss	 
		if( pick.fav && (pick.winnerStatus == 2)) {
			loss = "f";
		}
		else if (pick.dog && (pick.winnerStatus == 2) ) {
			winner = "d";
		} 
%>			 
		

		<div class="scorerow fav <%=i%> <%if(winner == "f") {%>loser<%}%>" <%if (pick.dog && update == true){%>onclick="updatePick(<%=pick.id%>, <%=pick.game.id%>, <%=pick.game.fav.id%>, <%=pick.game.dog.id%>, '<%=pick.game.fav.shortName%>', '<%=pick.game.dog.shortName%>', 'fav',<%=i%>)"<%}%>>
			<div class="teamname">
				<%=pick.game.fav.fullTeamName%><span class="spread">(<%=pick.game.spread%>)</span>
			</div>
			<div class="score"><%=pick.game.favScore%></div>
		</div>


		<div class="scorerow dog <%=i%> <%if(winner == "d") {%>loser<%}%>" <%if (pick.fav && update == true){%>onclick="updatePick(<%=pick.id%>, <%=pick.game.id%>, <%=pick.game.dog.id%>, <%=pick.game.fav.id%>, '<%=pick.game.dog.shortName%>', '<%=pick.game.fav.shortName%>', 'dog',<%=i%>)"<%}%>>
			<div class="teamname">
				<%=pick.game.dog.fullTeamName%></div>
				<div class="score"><%=pick.game.dogScore%></div>
			</div>
		</div>
	<div style="clear:both;"></div>
	</div>
	
<%
	}
	else {
		//no pick was made
%>


	<div class="scoreboard shadow <%if (game.gameStarted) {%>loss<%}%>">
		<div class="pickbox">
			<div class="pick <%=i%> <%if (game.gameStarted) {%>NOP<%}%>"></div>
		</div>

		<div class="scorerow fav <%=i%>" <%if (!game.gameStarted && update == true) {%>onclick="makePick(<%=game.id%>, <%=game.fav.id%>, <%=game.dog.id%>, '<%=game.fav.shortName%>', '<%=game.dog.shortName%>', 'fav', <%=i%>)"<%} else {%> loser<%}%>>
			<div class="teamname">
				<%=game.fav.fullTeamName%><span class="spread">(<%=game.spread%>)</span>
			</div>
			<div class="score"><%=game.favScore%></div>
		</div>

		<div class="scorerow dog <%=i%>" <%if (!game.gameStarted && update == true) {%>onclick="makePick(<%=game.id%>, <%=game.dog.id%>, <%=game.fav.id%>, '<%=game.dog.shortName%>', '<%=game.fav.shortName%>', 'dog', <%=i%>)"<%} else {%> loser<%}%>>
			<div class="teamname">
				<%=game.dog.fullTeamName%></div>
				<div class="score"><%=game.dogScore%></div>
			</div>
		</div>
	
		<div style="clear:both;"></div>
	</div>
<%

	}
%>
	
<%
	//close gamebox
%>
	</div>
	

<%
	$("#point-total").text('+'+points+' points');
});
%>
</script> 


<body>

<div class="bg"></div>

<div class="screen">

	<div class="nav shadow">
		<div class="mainnav">
			<div class="page-select">
				<select name="Page" id="page" onchange="getPage();">
					<option value="make" selected="selected">Make Picks</option>
					<option value="view">View Picks</option>
					<option value="standings">Standings</option>
				</select>
			</div>
			<div id="logout"><a href="#" onclick="logout()">logout</a></div>
			<div class="loader" id="loader-page"></div>
		</div>
		
		
		<div class="subnav" id="sn-view">	
				
		</div>
		
		
	</div>
	
	
	
	
	<div id="results"></div>
		
</div>
</body>
</html>
